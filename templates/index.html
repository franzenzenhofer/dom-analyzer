<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Statistician - Ultimate Website Analyzer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073; }
            to { text-shadow: 0 0 20px #fff, 0 0 30px #ff4da6, 0 0 40px #ff4da6; }
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .input-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        .url-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 18px;
            border: 3px solid #667eea;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
        }
        
        .url-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 15px rgba(118, 75, 162, 0.3);
        }
        
        .analyze-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 18px;
        }
        
        .loading.active {
            display: block;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .stat-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .domain-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .domain-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        
        .domain-item:hover {
            background: #f8f8f8;
        }
        
        .domain-category {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .same-origin {
            background: #4CAF50;
            color: white;
        }
        
        .subdomain {
            background: #FF9800;
            color: white;
        }
        
        .third-party {
            background: #f44336;
            color: white;
        }
        
        .graph-frame {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 15px;
            background: white;
        }
        
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .tag-item {
            padding: 8px 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tag-item:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .error-message {
            background: #ff5252;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .nerd-stats {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #00ff00;
            background: #000;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ì DOM STATISTICIAN ü§ì</h1>
            <div class="subtitle">The Ultimate Nerdy Website Analyzer - 10,000+ Stats!</div>
        </div>
        
        <div class="input-section">
            <input type="url" class="url-input" id="urlInput" placeholder="Enter URL to analyze (e.g., https://www.evi.gv.at/f/162414w)" value="https://www.evi.gv.at/f/162414w">
            <button class="analyze-btn" id="analyzeBtn" onclick="analyzeURL()">üîç ANALYZE DOM NOW!</button>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Performing deep DOM analysis... This is going to be EPIC!</div>
            </div>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="results" id="results">
            <!-- Overview Statistics -->
            <div class="stat-grid" id="overviewStats"></div>
            
            <!-- Domain Distribution Chart -->
            <div class="chart-container">
                <div class="chart-title">üåê Domain Distribution</div>
                <div id="domainChart"></div>
            </div>
            
            <!-- Asset Types Chart -->
            <div class="chart-container">
                <div class="chart-title">üìä Asset Types Distribution</div>
                <div id="assetChart"></div>
            </div>
            
            <!-- Tag Frequency Chart -->
            <div class="chart-container">
                <div class="chart-title">üè∑Ô∏è Top HTML Tags</div>
                <div id="tagChart"></div>
            </div>
            
            <!-- Heading Structure -->
            <div class="chart-container">
                <div class="chart-title">üìù Heading Structure</div>
                <div id="headingChart"></div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="chart-container">
                <div class="chart-title">‚ö° Performance Indicators</div>
                <div id="performanceChart"></div>
            </div>
            
            <!-- Accessibility Score -->
            <div class="chart-container">
                <div class="chart-title">‚ôø Accessibility Indicators</div>
                <div id="accessibilityChart"></div>
            </div>
            
            <!-- Third Party Domains List -->
            <div class="domain-list">
                <h3>üåç Third-Party Domains</h3>
                <div id="domainList"></div>
            </div>
            
            <!-- Dependency Graph -->
            <div class="chart-container">
                <div class="chart-title">üï∏Ô∏è Dependency Graph</div>
                <iframe id="graphFrame" class="graph-frame"></iframe>
            </div>
            
            <!-- Nerd Stats Terminal -->
            <div class="nerd-stats" id="nerdStats"></div>
        </div>
    </div>
    
    <script>
        function analyzeURL() {
            const url = document.getElementById('urlInput').value;
            if (!url) {
                showError('Please enter a URL to analyze!');
                return;
            }
            
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const errorMsg = document.getElementById('errorMessage');
            const btn = document.getElementById('analyzeBtn');
            
            loading.classList.add('active');
            results.classList.remove('active');
            errorMsg.style.display = 'none';
            btn.disabled = true;
            
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ url: url })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showError(data.error);
                } else {
                    displayResults(data);
                }
            })
            .catch(error => {
                showError('Failed to analyze URL: ' + error.message);
            })
            .finally(() => {
                loading.classList.remove('active');
                btn.disabled = false;
            });
        }
        
        function showError(message) {
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
        }
        
        function displayResults(data) {
            const results = document.getElementById('results');
            results.classList.add('active');
            
            // Display overview statistics
            displayOverviewStats(data.statistics);
            
            // Create charts
            createDomainChart(data.domain_stats);
            createAssetChart(data.assets);
            createTagChart(data.statistics.tag_frequency);
            createHeadingChart(data.statistics.content_analysis.headings);
            createPerformanceChart(data.statistics.performance_indicators);
            createAccessibilityChart(data.statistics.accessibility);
            
            // Display domain list
            displayDomainList(data.domain_stats);
            
            // Load dependency graph
            if (data.graph_path) {
                document.getElementById('graphFrame').src = '/' + data.graph_path;
            }
            
            // Display nerd stats
            displayNerdStats(data);
        }
        
        function displayOverviewStats(stats) {
            const container = document.getElementById('overviewStats');
            container.innerHTML = '';
            
            const overviewData = [
                { label: 'Total HTML Size', value: formatBytes(stats.html_stats.total_size) },
                { label: 'Total Tags', value: stats.html_stats.total_tags },
                { label: 'Unique Tags', value: stats.html_stats.unique_tags },
                { label: 'Word Count', value: stats.text_stats.word_count },
                { label: 'Images', value: stats.media_stats.images.total },
                { label: 'Scripts', value: stats.performance_indicators.external_scripts + stats.performance_indicators.inline_scripts },
                { label: 'Links', value: stats.content_analysis.links.total },
                { label: 'Forms', value: stats.content_analysis.forms },
                { label: 'Text/HTML Ratio', value: stats.text_stats.text_to_html_ratio.toFixed(1) + '%' },
                { label: 'Third-Party Domains', value: stats.domain_distribution.unique_third_party_domains },
                { label: 'CSS Classes', value: stats.css_complexity.classes_used },
                { label: 'Accessibility Score', value: Object.values(stats.accessibility).reduce((a,b) => a+b, 0) }
            ];
            
            overviewData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-label">${item.label}</div>
                    <div class="stat-value">${item.value}</div>
                `;
                container.appendChild(card);
            });
        }
        
        function createDomainChart(domainStats) {
            const data = [{
                values: [
                    domainStats.same_origin.length,
                    domainStats.subdomain.length,
                    domainStats.third_party.length
                ],
                labels: ['Same Origin', 'Subdomain', 'Third Party'],
                type: 'pie',
                marker: {
                    colors: ['#4CAF50', '#FF9800', '#f44336']
                }
            }];
            
            const layout = {
                height: 400,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('domainChart', data, layout);
        }
        
        function createAssetChart(assets) {
            const data = [{
                x: Object.keys(assets),
                y: Object.values(assets).map(a => Array.isArray(a) ? a.length : 0),
                type: 'bar',
                marker: {
                    color: 'rgb(102, 126, 234)'
                }
            }];
            
            const layout = {
                height: 400,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                xaxis: { title: 'Asset Type' },
                yaxis: { title: 'Count' }
            };
            
            Plotly.newPlot('assetChart', data, layout);
        }
        
        function createTagChart(tagFreq) {
            const sorted = Object.entries(tagFreq).sort((a,b) => b[1] - a[1]).slice(0, 15);
            
            const data = [{
                x: sorted.map(t => t[0]),
                y: sorted.map(t => t[1]),
                type: 'bar',
                marker: {
                    color: sorted.map((_, i) => `hsl(${270 - i * 10}, 70%, 50%)`)
                }
            }];
            
            const layout = {
                height: 400,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                xaxis: { title: 'HTML Tag' },
                yaxis: { title: 'Frequency' }
            };
            
            Plotly.newPlot('tagChart', data, layout);
        }
        
        function createHeadingChart(headings) {
            const data = [{
                x: Object.keys(headings),
                y: Object.values(headings),
                type: 'bar',
                marker: {
                    color: ['#667eea', '#764ba2', '#8b5cf6', '#a855f7', '#c084fc', '#d8b4fe']
                }
            }];
            
            const layout = {
                height: 300,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                xaxis: { title: 'Heading Level' },
                yaxis: { title: 'Count' }
            };
            
            Plotly.newPlot('headingChart', data, layout);
        }
        
        function createPerformanceChart(perf) {
            const data = [{
                type: 'scatterpolar',
                r: Object.values(perf),
                theta: Object.keys(perf),
                fill: 'toself',
                marker: { color: '#667eea' }
            }];
            
            const layout = {
                height: 400,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, Math.max(...Object.values(perf)) + 5]
                    }
                }
            };
            
            Plotly.newPlot('performanceChart', data, layout);
        }
        
        function createAccessibilityChart(access) {
            const data = [{
                x: Object.keys(access),
                y: Object.values(access),
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#4CAF50', width: 3 },
                marker: { size: 10 }
            }];
            
            const layout = {
                height: 400,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                xaxis: { title: 'Accessibility Feature' },
                yaxis: { title: 'Count' }
            };
            
            Plotly.newPlot('accessibilityChart', data, layout);
        }
        
        function displayDomainList(domainStats) {
            const container = document.getElementById('domainList');
            container.innerHTML = '';
            
            const allDomains = [
                ...domainStats.same_origin.map(d => ({url: d, category: 'same-origin'})),
                ...domainStats.subdomain.map(d => ({url: d, category: 'subdomain'})),
                ...domainStats.third_party.map(d => ({url: d, category: 'third-party'}))
            ];
            
            const uniqueDomains = {};
            allDomains.forEach(item => {
                const domain = new URL(item.url).hostname;
                if (!uniqueDomains[domain]) {
                    uniqueDomains[domain] = item.category;
                }
            });
            
            Object.entries(uniqueDomains).forEach(([domain, category]) => {
                const item = document.createElement('div');
                item.className = 'domain-item';
                item.innerHTML = `
                    <span>${domain}</span>
                    <span class="domain-category ${category}">${category.replace('-', ' ')}</span>
                `;
                container.appendChild(item);
            });
        }
        
        function displayNerdStats(data) {
            const stats = data.statistics;
            const nerdContainer = document.getElementById('nerdStats');
            
            const nerdData = `
===[ ULTRA NERD STATISTICS ]===================================
URL: ${data.url}
TIMESTAMP: ${new Date().toISOString()}

[HTML METRICS]
‚îú‚îÄ Total Size: ${stats.html_stats.total_size} bytes
‚îú‚îÄ Total Tags: ${stats.html_stats.total_tags}
‚îú‚îÄ Unique Tags: ${stats.html_stats.unique_tags}
‚îú‚îÄ DOCTYPE: ${stats.html_stats.doctype ? 'YES' : 'NO'}
‚îú‚îÄ Language: ${stats.html_stats.html_lang || 'NOT SET'}
‚îî‚îÄ Charset: ${stats.html_stats.charset || 'NOT SET'}

[HEAD ANALYSIS]
‚îú‚îÄ Title: "${stats.head_analysis?.title || 'NO TITLE'}"
‚îú‚îÄ Title Length: ${stats.head_analysis?.title_length || 0} chars
‚îú‚îÄ Meta Tags: ${stats.head_analysis?.meta_tags || 0}
‚îú‚îÄ OG Tags: ${Object.keys(stats.head_analysis?.og_tags || {}).length}
‚îú‚îÄ Twitter Cards: ${Object.keys(stats.head_analysis?.twitter_cards || {}).length}
‚îî‚îÄ Canonical: ${stats.head_analysis?.canonical ? 'SET' : 'NOT SET'}

[CONTENT METRICS]
‚îú‚îÄ Word Count: ${stats.text_stats.word_count}
‚îú‚îÄ Avg Word Length: ${stats.text_stats.average_word_length.toFixed(2)} chars
‚îú‚îÄ Text/HTML Ratio: ${stats.text_stats.text_to_html_ratio.toFixed(2)}%
‚îú‚îÄ Paragraphs: ${stats.text_stats.paragraph_count}
‚îú‚îÄ Total Links: ${stats.content_analysis.links.total}
‚îÇ  ‚îú‚îÄ Internal: ${stats.content_analysis.links.internal}
‚îÇ  ‚îú‚îÄ External: ${stats.content_analysis.links.external}
‚îÇ  ‚îî‚îÄ NoFollow: ${stats.content_analysis.links.nofollow}
‚îú‚îÄ Forms: ${stats.content_analysis.forms}
‚îú‚îÄ Inputs: ${stats.content_analysis.inputs}
‚îî‚îÄ Tables: ${stats.content_analysis.tables}

[PERFORMANCE INDICATORS]
‚îú‚îÄ Inline Scripts: ${stats.performance_indicators.inline_scripts}
‚îú‚îÄ External Scripts: ${stats.performance_indicators.external_scripts}
‚îú‚îÄ Async Scripts: ${stats.performance_indicators.async_scripts}
‚îú‚îÄ Defer Scripts: ${stats.performance_indicators.defer_scripts}
‚îú‚îÄ Inline Styles: ${stats.performance_indicators.inline_styles}
‚îú‚îÄ External Styles: ${stats.performance_indicators.external_styles}
‚îî‚îÄ Style Attributes: ${stats.performance_indicators.inline_style_attributes}

[DOMAIN DISTRIBUTION]
‚îú‚îÄ Same Origin: ${stats.domain_distribution.same_origin}
‚îú‚îÄ Subdomains: ${stats.domain_distribution.subdomain}
‚îú‚îÄ Third Party: ${stats.domain_distribution.third_party}
‚îî‚îÄ Unique 3rd Party: ${stats.domain_distribution.unique_third_party_domains}

[CSS COMPLEXITY]
‚îú‚îÄ Classes Used: ${stats.css_complexity.classes_used}
‚îú‚îÄ IDs Used: ${stats.css_complexity.ids_used}
‚îî‚îÄ Data Attributes: ${stats.css_complexity.data_attributes}

[STRUCTURED DATA]
‚îú‚îÄ JSON-LD Scripts: ${stats.structured_data.json_ld}
‚îú‚îÄ Microdata Items: ${stats.structured_data.microdata_items}
‚îú‚îÄ Microdata Props: ${stats.structured_data.microdata_props}
‚îî‚îÄ RDFa Properties: ${stats.structured_data.rdfa}

================================================================
            `;
            
            nerdContainer.textContent = nerdData;
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Auto-analyze on page load with default URL
        window.onload = function() {
            if (document.getElementById('urlInput').value) {
                // analyzeURL(); // Uncomment to auto-analyze on load
            }
        };
    </script>
</body>
</html>